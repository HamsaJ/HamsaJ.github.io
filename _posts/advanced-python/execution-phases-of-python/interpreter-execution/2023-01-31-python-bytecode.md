---
layout: post
title:  "Uncovering the Inner Workings of Python Bytecode"
date:   2023-01-31 08:25:37 +0000
categories: bytecode python
---

# Python bytecode

Python bytecode is the intermediate representation of a Python program that is executed by the Python Virtual Machine (PVM). It is a low-level representation of the Python source code, which is translated by the Python interpreter into machine code that can be executed on the host machine.

The process of converting Python source code to bytecode is called "compilation" and it happens automatically when a Python script is run. The bytecode is saved in a file with a .pyc extension, which can be reused when the same script is run again. This improves the performance of the script as it eliminates the need for recompilation every time the script is run.

The bytecode itself is a sequence of bytecode instructions, each represented by a single byte. These instructions are executed by the PVM using a stack-based virtual machine, similar to the one described in the previous answer.

Here is an example of a Python script and its corresponding bytecode:

```python
def add(a, b):
    return a + b

result = add(3, 4)
print(result)
```

```scss
 2           0 LOAD_FAST                0 (a)
            2 LOAD_FAST                1 (b)
            4 BINARY_ADD
            6 RETURN_VALUE

3           8 LOAD_GLOBAL              0 (add)
           10 LOAD_CONST               1 (3)
           12 LOAD_CONST               2 (4)
           14 CALL_FUNCTION            2
           16 STORE_FAST               2 (result)

4          18 LOAD_GLOBAL              1 (print)
           20 LOAD_FAST                 2 (result)
           22 CALL_FUNCTION            1
           24 POP_TOP
           26 LOAD_CONST               0 (None)
           28 RETURN_VALUE
```

The first column of the bytecode listing is the line number, the second is the bytecode instruction and the third is the argument passed to the instruction.

The bytecode instructions are executed by the PVM in a linear fashion, similar to how assembly code is executed by a CPU. Each instruction is executed one after the other, and the PVM uses a stack to store and manipulate data.

In this example, the bytecode first loads the two arguments passed to the add() function, performs the addition using the BINARY\_ADD instruction, and then returns the result using the RETURN\_VALUE instruction. The rest of the bytecode is used to call the add() function, store the result, call the print() function, and return None.

It's worth noting that this example is very simple and not representative of real-world Python code. However, it illustrates the basic concepts of Python bytecode and how it is executed by the PVM.

In conclusion, Python bytecode is the intermediate representation of a Python program that is executed by the PVM. It is a low-level representation of the Python source code that is automatically generated by the Python interpreter. The bytecode is executed by the PVM using a stack-based virtual machine, which makes it easy to implement and understand. The bytecode is saved in a file with a .pyc extension which can be reused when the same script is run again, improving the performance of the script.
